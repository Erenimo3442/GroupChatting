<!DOCTYPE html>
<html>

<head>
    <title>Get JWT Token</title>
</head>

<body>
    <h2>Register/Login to Get JWT Token</h2>

    <div>
        <h3>Register</h3>
        <input type="text" id="regUsername" placeholder="Username">
        <input type="password" id="regPassword" placeholder="Password">
        <button onclick="register()">Register</button>
    </div>

    <div>
        <h3>Login</h3>
        <input type="text" id="loginUsername" placeholder="Username">
        <input type="password" id="loginPassword" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>

    <div>
        <h3>JWT Token</h3>
        <textarea id="tokenResult" style="width: 500px; height: 100px;"
            placeholder="Your JWT token will appear here"></textarea>
        <br>
        <button onclick="copyToken()">Copy Token</button>
    </div>

    <script>
        async function register() {
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;

            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }

            try {
                const response = await fetch('http://localhost:8080/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert('Registration successful! Now please login to get your token.');
                    // Clear the registration form
                    document.getElementById('regUsername').value = '';
                    document.getElementById('regPassword').value = '';
                } else {
                    const error = await response.text();
                    alert('Registration failed: ' + error);
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }

            try {
                const response = await fetch('http://localhost:8080/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('tokenResult').value = data.accessToken;
                    alert('Login successful! Token copied to text area.');
                } else {
                    const error = await response.text();
                    alert('Login failed: ' + error);
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        function copyToken() {
            const tokenField = document.getElementById('tokenResult');
            tokenField.select();
            document.execCommand('copy');
            alert('Token copied to clipboard!');
        }
    </script>
</body>

</html>